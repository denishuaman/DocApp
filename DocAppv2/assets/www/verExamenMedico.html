<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Validacion de usuarios</title>
	<link rel="stylesheet" href="jquery.mobile/jquery.mobile-1.1.0.min.css" />
	<script src="jquery.mobile/jquery-1.7.2.min"></script>
	<script src="jquery.mobile/jquery.mobile-1.1.0.min.js"></script>
	<link rel="stylesheet" type="text/css" href="index.css" />
</head>

<body>

	<div data-role="page" id="verExamenMedico">
		<div class="barraTitulo">
			<img style="margin-left: 10px;" align="left" src="camp.png" /> 
			<img style="margin-left: 10px;" align="center" src="iconsuperior.png" />
			DocApp 
			<img style="margin-rigth: 10px;" align="right" src="help.png" />
			<img style="margin-rigth: 10px;" align="right" src="config.png" />
		</div>
		<div class="barraSubtitulo">Ver Examenes Medicos</div>
		<div data-role="content">
			<div id="verExamenMedicoLista"></div>
		</div>
	</div>
	<script src="index2.js"></script>
	<script type="text/javascript">
		var selReceta;
		function downloadFile() {
			window.requestFileSystem(LocalFileSystem.PERSISTENT,0,
							function onFileSystemSuccess(fileSystem) {
								fileSystem.root.getFile("dummy.html",{create : true,exclusive : false},
												function gotFileEntry(fileEntry) {
													var sPath = fileEntry.fullPath.replace("dummy.html","");
													var fileTransfer = new FileTransfer();
													fileEntry.remove();
													fileTransfer.download(
																	"http://www.w3.org/2011/web-apps-ws/papers/Nitobi.pdf",sPath+ "theFile.pdf",
																	function(theFile) {
																		console.log("download complete: "+ theFile.toURI());
																		showLink(theFile.toURI());
																	},
																	function(error) {
																		console.log("download error source "+ error.source);
																		console.log("download error target "+ error.target);
																		console.log("upload error code: "+ error.code);
																	});
												}, fail);
							}, fail);
		};

		$(".botonFormulario").live("click", function() {
			$.mobile.changePage('#verRecetaMedica');
		});
		$('#verExamenMedico').on('pagebeforeshow',
						function() {
							archivoValidacion = "http://docapp.esy.es/consultarExamen.php?jsoncallback=?";
							$.getJSON(archivoValidacion, {paciente : dniUsuario}).done(
											function(respuestaServer) {
												var listaPac = "<div id=\"verExamenMedicoLista\">";

												for (var i = 0; i < respuestaServer.length; i++) {

													listaPac = listaPac
															+ "<div class=\"contentInformacion\"><div>Examen: "
															+ (i + 1)
															+ "</div><div>Codigo de examen: "
															+ respuestaServer[i].Codigo
															+ "</div><div>Fecha: "
															+ respuestaServer[i].Fecha
															+ "</div><div>Tipo de analisis: "
															+ respuestaServer[i].Especialidad
															+ "</div><div onclick=\"downloadFile()\" class=\"botonFormulario\">Descargar Examen en PDF</div></div>";
												}

												listaPac = listaPac + "</div>";

												$("#verExamenMedicoLista").html(listaPac);
												$(".botonFormulario").trigger("create");
											}).fail(
													function() {
														alert("Ocurrio un error en la conexion");
													});
						});
	</script>
</body>
</html>